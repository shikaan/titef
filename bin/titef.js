#! /usr/bin/env node
!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t){const r={PENDING:"PENDING",SUCCESS:"SUCCESS",FAILURE:"FAILURE",IGNORED:"IGNORED"},n=Object.values(r),s=Number.parseInt(/(\d+)./.exec(process.version)[1],10);e.exports={EVENT:{PROCESS:{EXIT:"process:exit",EXIT_CODE:{FAILURE:"process:exit-code:failure"}},DATABASE:{RECORDSET:{CREATE:"database:recordset:create",CLOSED:"database:recordset:closed"},RECORD:{CREATE:"database:record:create",UPDATE:"database:record:update",CLOSE:"database:record:close"},PROCESS:{ENDED:"database:process:ended"}},SUITE:{STARTED:"suite:started",HOOKS:{REGISTER:"suite:hooks:register",UNREGISTER:"suite:hooks:unregister"},ENDED:"suite:ended"},SPEC:{SETUP:{REGISTER:"spec:before-each:register",UNREGISTER:"spec:before-each:unregister"},TEARDOWN:{REGISTER:"spec:after-each:register",UNREGISTER:"spec:after-each:unregister"},STARTED:"spec:started",SUCCESS:"spec:success",IGNORE:"spec:ignore",FAILURE:"spec:failure",ENDED:"spec:ended"},REPORTER:{REPORT:{START:"reporter:report:start",ENDED:"reporter:report:ended"}}},NODE_MAJOR_VERSION:s,RESULT:r,RESULTS:n}},function(e,t){e.exports=require("events")},function(e,t){e.exports={isNumber:e=>"[object Number]"===Object.prototype.toString.call(e),isFunction:e=>/\[object (Async)?Function]/.test(Object.prototype.toString.call(e)),isObject:e=>"[object Object]"===Object.prototype.toString.call(e)}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){const r=new Map,n={setTimeout:setTimeout,setInterval:setInterval,clearTimeout:clearTimeout,clearInterval:clearInterval};e.exports={ERROR:{INTERVAL:"ERR_CLEAR_INTERVAL",TIMEOUT:"ERR_CLEAR_TIMEOUT"},rejectMap:r,oldies:n}},function(e,t,r){const n=r(1),{EVENT:s}=r(0),o=new n,i={before:{},after:{}};o.on(s.SPEC.SETUP.REGISTER,(e,t)=>{i.before[e]=t}),o.on(s.SPEC.TEARDOWN.REGISTER,(e,t)=>{i.after[e]=t}),o.on(s.SPEC.SETUP.UNREGISTER,e=>{i.before[e]=null}),o.on(s.SPEC.TEARDOWN.UNREGISTER,e=>{i.after[e]=null}),e.exports={spec:async function(e,t){const r=String(e).replace("."," "),n=this.path,c=`${n}.${r}`;o.emit(s.SPEC.STARTED,c),i.before&&i.before[n]&&i.before[n]();try{await t(),o.emit(s.SPEC.SUCCESS,c)}catch(e){o.emit(s.SPEC.FAILURE,c,e)}i.after&&i.after[n]&&i.after[n](),o.emit(s.SPEC.ENDED,c)},xspec:async function(e){const t=String(e).replace("."," "),r=`${this.path}.${t}`;o.emit(s.SPEC.STARTED,r),o.emit(s.SPEC.IGNORE,r),o.emit(s.SPEC.ENDED,r)},Spec:o}},function(e,t,r){const n=r(1),{isFunction:s,isObject:o}=r(2),{EVENT:i}=r(0),c=new n;e.exports={suite:function(e,...t){const r=String(e).replace("."," "),n=this.path,E=n?`${n}.${r}`:r,a={title:r,setup:Function(),teardown:Function(),eachSetup:Function(),eachTeardown:Function(),silent:!1},{options:u,callback:p}=function(e,t){const r=e[0],n=e[1];switch(e.length){case 1:if(!s(r))throw new TypeError("Second argument must be a function!");return{options:t,callback:r};case 2:if(!o(r))throw new TypeError("Second argument must be an object!");if(!s(n))throw new TypeError("Third argument must be a function!");return{options:Object.assign({},t,r),callback:n};default:throw new TypeError(`Invalid arguments! Expected (title: string, options?: object, callback: function). Actual: ${e.map(String).join()}`)}}(t,a);if(c.emit(i.SUITE.STARTED,E,u.silent),c.emit(i.SUITE.HOOKS.REGISTER,E,u.eachSetup,u.eachTeardown),!s(u.setup))throw new TypeError("Setup must be a function!");u.setup(),p.call(Object.assign(this,{path:E})),Object.assign(this,{path:n}),c.on(i.SUITE.ENDED,e=>{if(e===E){if(!s(u.teardown))throw new TypeError("Teardown must be a function!");u.teardown(),c.emit(i.SUITE.HOOKS.UNREGISTER),c.removeAllListeners(i.SUITE.ENDED)}})},Suite:c}},function(module,exports,__webpack_require__){const{resolve:resolve}=__webpack_require__(3),{existsSync:existsSync}=__webpack_require__(4),{printHelp:printHelp,printVersion:printVersion}=__webpack_require__(9),{getFiles:getFiles}=__webpack_require__(10),CLI_OPTION={HELP:"help",VERSION:"version",EXTENSIONS:"extensions",DIRECTORY:"directory"};function getFlagValue(e,t,r){return r?!!e.find(e=>e===t||e===r):!!e.find(e=>e===t)}function getArgumentValue(e,t,r){const n=e.findIndex(e=>e.includes(t)||e.includes(r)),s=e[n];return s.includes("=")?s.split("=")[1]:e[n+1]}function getParameterValue(e){return e[e.length-1]}function getCLIOptions(e){const t=e.slice(2),r=getFlagValue(t,"--help","-h"),n=getFlagValue(t,"--version","-v"),s=getArgumentValue(t,"--extensions","-e"),o=getParameterValue(e);return{[CLI_OPTION.HELP]:r,[CLI_OPTION.VERSION]:n,[CLI_OPTION.EXTENSIONS]:s,[CLI_OPTION.DIRECTORY]:o}}!function main(){const CLIOptions=getCLIOptions(process.argv);CLIOptions[CLI_OPTION.HELP]?(printHelp(),process.exit(0)):CLIOptions[CLI_OPTION.VERSION]&&(printVersion(),process.exit(0));const rootDirectoryPath=resolve(CLIOptions[CLI_OPTION.DIRECTORY]);if(!rootDirectoryPath)throw new Error("Missing path to test file! Use `titef --help` for further information");if(!existsSync(rootDirectoryPath))throw new Error(`The directory at ${rootDirectoryPath} does not exist! Use \`titef --help\` for further information`);__webpack_require__(11),__webpack_require__(16);const testFiles=getFiles(rootDirectoryPath,{extensions:CLIOptions[CLI_OPTION.EXTENSIONS]});testFiles.forEach(testFile=>{eval("require")(testFile)})}()},function(e,t){const r=(...e)=>{const t=[...e,"\n"];return process.stdout.write(t.map(String).join(""))};e.exports={printHelp(){r("Usage: titef [OPTIONS] [DIRECTORY]\nExecutes test files written in Titef (https://www.npmjs.com/package/titef) framework.\n\nOptions:\n  -h, --help                shows this help\n  -v, --version             prints version number\n  -e, --extensions [string] comma separated list of file extensions to test\n\nExample:\n\n  titef -e spec.js,test.js ./src\n\n  ")},printVersion(){r(void 0)}}},function(e,t,r){const{readdirSync:n,statSync:s}=r(4),{join:o}=r(3);e.exports={getFiles:function e(t,r={}){const i=n(t),c=function(e){return e?e.split(","):[]}(r.extensions);return i.reduce((n,i)=>{const E=o(t,i);if(s(E).isDirectory()){const t=e(E,r);n.push(...t)}else c.some(e=>E.endsWith(e))&&n.push(E);return n},[])}}},function(e,t,r){r(12),r(13),r(14)},function(e,t,r){const{isNumber:n}=r(2),{ERROR:s,rejectMap:o,oldies:i}=r(5);setTimeout=((e,t)=>{if(!n(t)&&t>=0)throw new TypeError("Timeout should be a positive number!");let r,c;const E=new Promise((n,s)=>{c=s,r=i.setTimeout(()=>{try{e(),n()}catch(e){s(e),i.clearTimeout(r)}},t)}).catch(e=>{if(e!==s.TIMEOUT)throw e;i.clearTimeout(r)});return o.set(E,c),E}),clearTimeout=(e=>{const[t,r]=(()=>e?[e,o.get(e)]:[o.entries()])();if(!r)throw new Error("Unable to find timeout");r(s.TIMEOUT),o.delete(t)})},function(e,t,r){const{isNumber:n}=r(2),{ERROR:s,rejectMap:o,oldies:i}=r(5);setInterval=((e,t)=>{if(!n(t)&&t>=0)throw new TypeError("Timeout should be a positive number!");let r,c;const E=new Promise((n,s)=>{c=s,r=i.setInterval(()=>{try{e()}catch(e){s(e),i.clearInterval(r)}},t)}).catch(e=>{if(e!==s.INTERVAL)throw e;i.clearInterval(r)});return o.set(E,c),E}),clearInterval=(e=>{const[t,r]=(()=>e?[e,o.get(e)]:[o.entries()])();if(!r)throw new Error("Unable to find interval promise");r(s.INTERVAL),o.delete(t)})},function(e,t,r){const n=r(15);n.throwsAsync=(async(e,t,r)=>{let s=()=>{};try{await e()}catch(e){s=(()=>{throw e})}finally{n.throws(s,t,r)}}),n.doesNotThrowAsync=(async(e,t,r)=>{let s=()=>{};try{await e()}catch(e){s=(()=>{throw e})}finally{n.doesNotThrow(s,t,r)}})},function(e,t){e.exports=require("assert")},function(e,t,r){const{spec:n,xspec:s}=r(6),{suite:o}=r(7);r(17).init();const i={},c={suite:o.bind(i),describe:o.bind(i),spec:n.bind(i),it:n.bind(i),test:n.bind(i),xspec:s.bind(i),xit:s.bind(i),xtest:s.bind(i)};Object.assign(global,c),e.exports=c},function(e,t,r){const{EVENT:n,RESULT:s}=r(0),o=r(18),i=r(21),c=r(22),{Spec:E}=r(6),{Suite:a}=r(7);e.exports=new class{init(){this._reporters=[o],a.on(n.SUITE.STARTED,(e,t)=>{i.emit(n.DATABASE.RECORDSET.CREATE,e,t)}),a.on(n.SUITE.HOOKS.REGISTER,(e,t,r)=>{E.emit(n.SPEC.SETUP.REGISTER,e,t),E.emit(n.SPEC.TEARDOWN.REGISTER,e,r)}),a.on(n.SUITE.HOOKS.UNREGISTER,()=>{E.emit(n.SPEC.SETUP.UNREGISTER),E.emit(n.SPEC.TEARDOWN.UNREGISTER)}),E.on(n.SPEC.STARTED,e=>{i.emit(n.DATABASE.RECORD.CREATE,e)}),E.on(n.SPEC.SUCCESS,e=>{i.emit(n.DATABASE.RECORD.UPDATE,e,s.SUCCESS)}),E.on(n.SPEC.IGNORE,e=>{i.emit(n.DATABASE.RECORD.UPDATE,e,s.IGNORED)}),E.on(n.SPEC.FAILURE,(e,t)=>{i.emit(n.DATABASE.RECORD.UPDATE,e,s.FAILURE,t),c.emit(n.PROCESS.EXIT_CODE.FAILURE)}),E.on(n.SPEC.ENDED,e=>{i.emit(n.DATABASE.RECORD.CLOSE,e)}),i.on(n.DATABASE.PROCESS.ENDED,e=>{this._reporters.forEach(t=>{t.emit(n.REPORTER.REPORT.START,e)})}),i.on(n.DATABASE.RECORDSET.CLOSED,e=>{a.emit(n.SUITE.ENDED,e)}),this._reporters.forEach(e=>{e.on(n.REPORTER.REPORT.ENDED,()=>{c.emit(n.PROCESS.EXIT)})})}}},function(e,t,r){const n=r(1),{printDatabase:s}=r(19),{EVENT:o}=r(0);e.exports=new class extends n{constructor(){super(),this.on(o.REPORTER.REPORT.START,async e=>{await s(e),this.emit(o.REPORTER.REPORT.ENDED)})}}},function(e,t,r){const{isFunction:n}=r(2),{TEXT_FORMAT:s}=r(20),{NODE_MAJOR_VERSION:o,RESULT:i}=r(0),c=(...e)=>{const t=[...e,s.RESET,"\n"];return process.stdout.write(t.map(String).join(""))},E=e=>n(e)?e.name:String(e),a=(e,t,r="")=>{const n={};if(!e.meta.silent){const n=e.meta.duration>2e3?[s.RESET,s.YELLOW,` (${Math.ceil(e.meta.duration)}ms)`]:[];c(s.BOLD,`${r}${t.toUpperCase()}`,...n)}return Object.entries(e).forEach(([o,E])=>{if(!(E.meta&&E.meta.silent||e.meta.silent))if(E.meta)Object.assign(n,a(E,o,`${r}    `));else{const e=E.duration>500?[s.YELLOW,` (${Math.ceil(E.duration)}ms)`]:[];E.result===i.SUCCESS?c(s.GREEN,`${r} ✔ ${o}`,...e):E.result===i.IGNORED?c(s.YELLOW,`${r} - ${o}`,...e):E.result===i.PENDING?c(s.GREY,`${r} . ${o}`,...e):(c(s.RED,`${r} ✕ ${o}`),n[`${t} > ${o}`]=E.payload)}}),n};e.exports={printDatabase:async e=>{let t={};Object.entries(e).forEach(([e,r])=>{t=a(r,e),c("\n  Duration: ",s.YELLOW,`${Math.ceil(r.meta.duration)/1e3}s`)});const r=Object.entries(t);r.length&&(c(s.BOLD,"\nError details:"),r.forEach((e,t)=>{const r=e[0],n=e[1];c(s.BOLD,`\n${t+1}) ${r}`),(e=>{const t=(e=>e.message?e.message:e.toString().split(":").slice(-1)[0])(e),r=o<10;if((e=>"ERR_ASSERTION"===e.code||e.toString().includes("AssertionError"))(e)){const n=E(e.operator),o=E(e.expected),i=E(e.actual);r&&c(`ASSERTION FAILURE: ${t}`),"fail"===n?c("\tUnexpected:\t",s.RED,`${i}`):!n&&e.expected&&e.actual&&(c("\tExpected:\t",s.GREEN,o),c("\tActual:\t\t",s.RED,i))}else r&&c(`ERROR: ${t}`);c(s.GREY,e.stack)})(n)}))}}},function(e,t){e.exports={TEXT_FORMAT:{RED:"[31m",GREEN:"[32m",YELLOW:"[33m",RESET:"[0m",BOLD:"[1m",GREY:"[90m"}}},function(e,t,r){const n=r(1),{EVENT:s,RESULT:o,RESULTS:i}=r(0);class c extends n{static create(e,t,r){const[n,s]=t.split(/\.(.*)/);return s?(e[n]=e[n]||{},c.create(e[n],s,r)):(e[n]=r,e)}static open(e,t){const[r,n]=t.split(/\.(.*)/);return n?c.open(e[r],n):e[r]}static parent(e,t){const[r,n]=t.split(/\.(.*)/);return n?c.parent(e[r],n):e}static toMilliseconds([e,t]){return(1e9*e+t)/1e6}constructor(){super(),this._recordsets={},this._processed=0,this._created=0,this.on(s.DATABASE.RECORDSET.CREATE,this.createRecordset),this.on(s.DATABASE.RECORD.CREATE,this.createRecord),this.on(s.DATABASE.RECORD.UPDATE,this.updateRecord),this.on(s.DATABASE.RECORD.CLOSE,this.closeRecord)}createRecordset(e,t){const r={duration:process.hrtime(),processed:0,path:e,silent:t};c.create(this._recordsets,e,Object.defineProperty({},"meta",{value:r}))}createRecord(e){if(!e)throw new TypeError("Missing record path!");if(!c.parent(this._recordsets,e))throw new TypeError(`Missing or null records list for ${e}`);this._created+=1,c.create(this._recordsets,e,{result:o.PENDING,payload:null,duration:process.hrtime()})}updateRecord(e,t,r){if(!i.includes(t))throw new TypeError(`Result should be one of ${i.join()}. Got ${t}.`);const n=c.open(this._recordsets,e);if(!n)throw new TypeError(`Missing or null records list for ${e}`);n.result=t,n.payload=r}closeRecord(e){setImmediate(()=>{this._processed+=1;const t=this._processed===this._created,r=c.parent(this._recordsets,e);r.meta.processed+=1;const n=Object.values(r).filter(e=>!e.meta).length,o=r.meta.processed===n;if(t)r.meta.duration=c.toMilliseconds(process.hrtime(r.meta.duration)),this.emit(s.DATABASE.PROCESS.ENDED,this._recordsets);else if(o)r.meta.duration=c.toMilliseconds(process.hrtime(r.meta.duration)),this.emit(s.DATABASE.RECORDSET.CLOSED,r.meta.path);else{const t=c.open(this._recordsets,e);t.duration=c.toMilliseconds(process.hrtime(t.duration))}})}}e.exports=new c},function(e,t,r){const n=r(1),{EVENT:s}=r(0);e.exports=new class extends n{constructor(){super(),this._exitCode=0,this.on(s.PROCESS.EXIT,()=>{setImmediate(()=>{process.exit(this._exitCode)})}),this.on(s.PROCESS.EXIT_CODE.FAILURE,()=>{this._exitCode=1})}}}]));