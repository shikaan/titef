#!/usr/bin/env node
(function () {var Y=this;var E={};class w{static print(...t){console.log(...t)}static printHelp(){w.print("Usage: titef [OPTIONS] [DIRECTORY]\n    Executes test files written in Titef (https://www.npmjs.com/package/titef) framework.\n\n    Options:\n      -h, --help                shows this help\n      -v, --version             prints version number\n      -e, --extensions [string] comma separated list of file extensions to test\n\n    Example:\n\n      titef -e spec.js,test.js ./src\n    ")}static printVersion(){w.print(process.env.TRAVIS_TAG||"development")}}E=w;var o={};class l{constructor(r){this.argv=[...r]}getFlagValue(r,e){return e?!!this.argv.find(t=>t===r||t===e):!!this.argv.find(e=>e===r)}getArgumentValue(r,e){const t=this.argv.findIndex(t=>t.includes(r)||t.includes(e)),a=this.argv[t];return a?(a.includes("=")?a.split("=")[1]:this.argv[t+1]).replace(/"/g,""):""}getParameterValue(){return this.argv[this.argv.length-1]}getCLIOptions(){const r=this.getFlagValue("--help","-h"),e=this.getFlagValue("--version","-v"),t=this.getArgumentValue("--extensions","-e"),a=this.getParameterValue();return{[l.CLI_OPTION.HELP]:r,[l.CLI_OPTION.VERSION]:e,[l.CLI_OPTION.EXTENSIONS]:t,[l.CLI_OPTION.DIRECTORY]:a}}}l.CLI_OPTION={HELP:"help",VERSION:"version",EXTENSIONS:"extensions",DIRECTORY:"directory"},o=l;var Z={};const{readdirSync:$,statSync:_}=require("fs"),{join:aa,basename:ba}=require("path");class F{constructor(e,r){this.directory=e,this.options=F.parseOptions(r)}static parseOptions(e){return{extensions:e.extensions?e.extensions.split(","):[]}}hasFileAllowedExtension(e){const r=ba(e),s=r.substring(r.indexOf(".")+1);return this.options.extensions.some(e=>s===e)}getFiles(e=this.directory){return $(e).reduce((r,s)=>{const t=aa(e,s);if(_(t).isDirectory()){const e=this.getFiles(t);r.push(...e)}else{this.hasFileAllowedExtension(t)&&r.push(t)}return r},[])}}Z=F;var q,ca,da,ea,fa=false;function r(){if(fa)return;fa=true;q={};ca=t=>"[object Number]"===Object.prototype.toString.call(t);da=t=>/\[object (Async)?Function]/.test(Object.prototype.toString.call(t));ea=t=>"[object Object]"===Object.prototype.toString.call(t);q={isNumber:ca,isFunction:da,isObject:ea}}var G,ga,ha,ia,ja=false;function H(){if(ja)return;ja=true;G={};ga={INTERVAL:"ERR_CLEAR_INTERVAL",TIMEOUT:"ERR_CLEAR_TIMEOUT"};ha=new Map;ia={setTimeout:setTimeout,setInterval:setInterval,clearTimeout:clearTimeout,clearInterval:clearInterval};G={ERROR:ga,rejectMap:ha,oldies:ia}}var ka,I,s,x,la=false;function ma(){if(la)return;la=true;({isNumber:ka}=(r(),q));({ERROR:I,rejectMap:s,oldies:x}=(H(),G));setTimeout=(e,r)=>{if(!ka(r)&&r>=0)throw new TypeError("Timeout should be a positive number!");let $,t;const l=new Promise((l,a)=>{t=a,$=x.setTimeout(()=>{try{e(),l()}catch(r){a(r),x.clearTimeout($)}},r)}).catch(e=>{if(e!==I.TIMEOUT)throw e;x.clearTimeout($)});return s.set(l,t),l},clearTimeout=e=>{const[r,$]=(()=>e?[e,s.get(e)]:[s.entries()])();if(!$)throw new Error("Unable to find timeout");$(I.TIMEOUT),s.delete(r)}}var na,J,u,y,oa=false;function pa(){if(oa)return;oa=true;({isNumber:na}=(r(),q));({ERROR:J,rejectMap:u,oldies:y}=(H(),G));setInterval=(e,r)=>{if(!na(r)&&r>=0)throw new TypeError("Timeout should be a positive number!");let $,a;const t=new Promise((t,h)=>{a=h,$=y.setInterval(()=>{try{e()}catch(r){h(r),y.clearInterval($)}},r)}).catch(e=>{if(e!==J.INTERVAL)throw e;y.clearInterval($)});return u.set(t,a),t},clearInterval=e=>{const[r,$]=(()=>e?[e,u.get(e)]:[u.entries()])();if(!$)throw new Error("Unable to find interval promise");$(J.INTERVAL),u.delete(r)}}var qa=false;function ra(){if(qa)return;qa=true;ma(),pa()}var j,sa,K,ta,ua,va=false;function k(){if(va)return;va=true;j={};sa={PROCESS:{EXIT:"process:exit",EXIT_CODE:{FAILURE:"process:exit-code:failure"}},DATABASE:{RECORDSET:{CREATE:"database:recordset:create",CLOSED:"database:recordset:closed"},RECORD:{CREATE:"database:record:create",UPDATE:"database:record:update",CLOSE:"database:record:close"},PROCESS:{ENDED:"database:process:ended"}},SUITE:{STARTED:"suite:started",HOOKS:{REGISTER:"suite:hooks:register",UNREGISTER:"suite:hooks:unregister"},ENDED:"suite:ended"},SPEC:{SETUP:{REGISTER:"spec:before-each:register",UNREGISTER:"spec:before-each:unregister"},TEARDOWN:{REGISTER:"spec:after-each:register",UNREGISTER:"spec:after-each:unregister"},STARTED:"spec:started",SUCCESS:"spec:success",IGNORE:"spec:ignore",FAILURE:"spec:failure",ENDED:"spec:ended"},REPORTER:{REPORT:{START:"reporter:report:start",ENDED:"reporter:report:ended"}}};K={PENDING:"PENDING",SUCCESS:"SUCCESS",FAILURE:"FAILURE",IGNORED:"IGNORED"};ta=Object.values(K);ua=Number.parseInt(/(\d+)./.exec(process.version)[1],10);j={EVENT:sa,NODE_MAJOR_VERSION:ua,RESULT:K,RESULTS:ta}}var L,wa,f,a,g,xa=false;async function ya($,r){const e=String($).replace("."," "),i=this.path,S=`${i}.${e}`;a.emit(f.SPEC.STARTED,S),g.before&&g.before[i]&&g.before[i]();try{await r(),a.emit(f.SPEC.SUCCESS,S)}catch(n){a.emit(f.SPEC.FAILURE,S,n)}g.after&&g.after[i]&&g.after[i](),a.emit(f.SPEC.ENDED,S)}async function za($){const r=String($).replace("."," "),e=`${this.path}.${r}`;a.emit(f.SPEC.STARTED,e),a.emit(f.SPEC.IGNORE,e),a.emit(f.SPEC.ENDED,e)}function M(){if(xa)return;xa=true;L={};wa=require("events");({EVENT:f}=(k(),j));a=new wa;g={before:{},after:{}};a.on(f.SPEC.SETUP.REGISTER,($,r)=>{g.before[$]=r}),a.on(f.SPEC.TEARDOWN.REGISTER,($,r)=>{g.after[$]=r}),a.on(f.SPEC.SETUP.UNREGISTER,$=>{g.before[$]=null}),a.on(f.SPEC.TEARDOWN.UNREGISTER,$=>{g.after[$]=null}),L={spec:ya,xspec:za,Spec:a}}var N,Aa,v,Ba,p,m,Ca=false;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Da(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach(function(t){Ea(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ea(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fa(e,t){const r=e[0],n=e[1];switch(e.length){case 1:if(!v(r))throw new TypeError("Second argument must be a function!");return{options:t,callback:r};case 2:if(!Ba(r))throw new TypeError("Second argument must be an object!");if(!v(n))throw new TypeError("Third argument must be a function!");return{options:Da({},t,{},r),callback:n};default:throw new TypeError(`Invalid arguments! Expected (title: string, options?: object, callback: function). Actual: ${e.map(String).join()}`);}}function Ga(e,...t){const r=String(e).replace("."," "),n=this.path,$=n?`${n}.${r}`:r,a={title:r,setup:Function(),teardown:Function(),eachSetup:Function(),eachTeardown:Function(),silent:!1},{options:i,callback:o}=Fa(t,a);if(m.emit(p.SUITE.STARTED,$,i.silent),m.emit(p.SUITE.HOOKS.REGISTER,$,i.eachSetup,i.eachTeardown),!v(i.setup))throw new TypeError("Setup must be a function!");i.setup(),o.call(Object.assign(this,{path:$})),Object.assign(this,{path:n}),m.on(p.SUITE.ENDED,e=>{if(e===$){if(!v(i.teardown))throw new TypeError("Teardown must be a function!");i.teardown(),m.emit(p.SUITE.HOOKS.UNREGISTER),m.removeAllListeners(p.SUITE.ENDED)}})}function P(){if(Ca)return;Ca=true;N={};Aa=require("events");({isFunction:v,isObject:Ba}=(r(),q));({EVENT:p}=(k(),j));m=new Aa;N={suite:Ga,Suite:m}}var Ha,Ia,Ja=false;function Ka(){if(Ja)return;Ja=true;Ha={};Ia={RED:"\x1B[31m",GREEN:"\x1B[32m",YELLOW:"\x1B[33m",RESET:"\x1B[0m",BOLD:"\x1B[1m",GREY:"\x1B[90m"};Ha={TEXT_FORMAT:Ia}}var La,Ma,c,Na,z,d,A,Oa,Pa,Qa,Q,Ra,Sa=false;function Ta(){if(Sa)return;Sa=true;La={};({isFunction:Ma}=(r(),q));({TEXT_FORMAT:c}=(Ka(),Ha));({NODE_MAJOR_VERSION:Na,RESULT:z}=(k(),j));d=(...$)=>{const r=[...$,c.RESET,"\n"];return process.stdout.write(r.map(String).join(""))};A=$=>Ma($)?$.name:String($);Oa=$=>$.message?$.message:$.toString().split(":").slice(-1)[0];Pa=$=>"ERR_ASSERTION"===$.code||$.toString().includes("AssertionError");Qa=$=>{const r=Oa($),t=Na<10;if(Pa($)){const a=A($.operator),e=A($.expected),p=A($.actual);t&&d(`ASSERTION FAILURE: ${r}`),"fail"===a?d("\tUnexpected:\t",c.RED,`${p}`):!a&&$.expected&&$.actual&&(d("\tExpected:\t",c.GREEN,e),d("\tActual:\t\t",c.RED,p))}else t&&d(`ERROR: ${r}`);d(c.GREY,$.stack)};Q=($,r,t="")=>{const a={};if(!$.meta.silent){const a=$.meta.duration>2e3?[c.RESET,c.YELLOW,` (${Math.ceil($.meta.duration)}ms)`]:[];d(c.BOLD,`${t}${r.toUpperCase()}`,...a)}return Object.entries($).forEach(([e,p])=>{if(!(p.meta&&p.meta.silent||$.meta.silent)){if(p.meta)Object.assign(a,Q(p,e,`${t}    `));else{const $=p.duration>500?[c.YELLOW,` (${Math.ceil(p.duration)}ms)`]:[];p.result===z.SUCCESS?d(c.GREEN,`${t} ✔ ${e}`,...$):p.result===z.IGNORED?d(c.YELLOW,`${t} - ${e}`,...$):p.result===z.PENDING?d(c.GREY,`${t} . ${e}`,...$):(d(c.RED,`${t} ✕ ${e}`),a[`${r} > ${e}`]=p.payload)}}}),a};Ra=async $=>{let r={};Object.entries($).forEach(([$,t])=>{r=Q(t,$),d("\n  Duration: ",c.YELLOW,`${Math.ceil(t.meta.duration)/1e3}s`)});const t=Object.entries(r);t.length&&(d(c.BOLD,"\nError details:"),t.forEach(($,r)=>{const t=$[0],a=$[1];d(c.BOLD,`\n${r+1}) ${t}`),Qa(a)}))};La={printDatabase:Ra}}var Ua,Va,Wa,R,Xa,Ya=false;function Za(){if(Ya)return;Ya=true;Ua={};Va=require("events");({printDatabase:Wa}=(Ta(),La));({EVENT:R}=(k(),j));Xa=class $oguB$var$Reporter extends Va{constructor(){super(),this.on(R.REPORTER.REPORT.START,async $=>{await Wa($),this.emit(R.REPORTER.REPORT.ENDED)})}};Ua=new Xa}var $a,_a,n,ab,S,bb,cb=false;function db(){if(cb)return;cb=true;$a={};_a=require("events");({EVENT:n,RESULT:ab,RESULTS:S}=(k(),j));bb=class $ftui$var$Database extends _a{static create(t,e,r){const[s,a]=e.split(/\.(.*)/);return a?(t[s]=t[s]||{},$ftui$var$Database.create(t[s],a,r)):(t[s]=r,t)}static open(t,e){const[r,s]=e.split(/\.(.*)/);return s?$ftui$var$Database.open(t[r],s):t[r]}static parent(t,e){const[r,s]=e.split(/\.(.*)/);return s?$ftui$var$Database.parent(t[r],s):t}static toMilliseconds([t,e]){return(1e9*t+e)/1e6}constructor(){super(),this._recordsets={},this._processed=0,this._created=0,this.on(n.DATABASE.RECORDSET.CREATE,this.createRecordset),this.on(n.DATABASE.RECORD.CREATE,this.createRecord),this.on(n.DATABASE.RECORD.UPDATE,this.updateRecord),this.on(n.DATABASE.RECORD.CLOSE,this.closeRecord)}createRecordset(t,e){const r={duration:process.hrtime(),processed:0,path:t,silent:e};$ftui$var$Database.create(this._recordsets,t,Object.defineProperty({},"meta",{value:r}))}createRecord(t){if(!t)throw new TypeError("Missing record path!");if(!$ftui$var$Database.parent(this._recordsets,t))throw new TypeError(`Missing or null records list for ${t}`);this._created+=1,$ftui$var$Database.create(this._recordsets,t,{result:ab.PENDING,payload:null,duration:process.hrtime()})}updateRecord(t,e,r){if(!S.includes(e))throw new TypeError(`Result should be one of ${S.join()}. Got ${e}.`);const s=$ftui$var$Database.open(this._recordsets,t);if(!s)throw new TypeError(`Missing or null records list for ${t}`);s.result=e,s.payload=r}closeRecord(t){setImmediate(()=>{this._processed+=1;const e=this._processed===this._created,r=$ftui$var$Database.parent(this._recordsets,t);r.meta.processed+=1;const s=Object.values(r).filter(t=>!t.meta).length,a=r.meta.processed===s;if(e)r.meta.duration=$ftui$var$Database.toMilliseconds(process.hrtime(r.meta.duration)),this.emit(n.DATABASE.PROCESS.ENDED,this._recordsets);else if(a)r.meta.duration=$ftui$var$Database.toMilliseconds(process.hrtime(r.meta.duration)),this.emit(n.DATABASE.RECORDSET.CLOSED,r.meta.path);else{const e=$ftui$var$Database.open(this._recordsets,t);e.duration=$ftui$var$Database.toMilliseconds(process.hrtime(e.duration))}})}};$a=new bb}var eb,fb,T,gb,hb=false;function ib(){if(hb)return;hb=true;eb={};fb=require("events");({EVENT:T}=(k(),j));gb=class $DVdD$var$ProcessManager extends fb{constructor(){super(),this._exitCode=0,this.on(T.PROCESS.EXIT,()=>{setImmediate(()=>{process.exit(this._exitCode)})}),this.on(T.PROCESS.EXIT_CODE.FAILURE,()=>{this._exitCode=1})}};eb=new gb}var jb,b,B,kb,h,U,e,t,lb,mb=false;function nb(){if(mb)return;mb=true;jb={};({EVENT:b,RESULT:B}=(k(),j));kb=(Za(),Ua);h=(db(),$a);U=(ib(),eb);({Spec:e}=(M(),L));({Suite:t}=(P(),N));lb=class $LyAn$var$EventBus{init(){this._reporters=[kb],t.on(b.SUITE.STARTED,($,E)=>{h.emit(b.DATABASE.RECORDSET.CREATE,$,E)}),t.on(b.SUITE.HOOKS.REGISTER,($,E,a)=>{e.emit(b.SPEC.SETUP.REGISTER,$,E),e.emit(b.SPEC.TEARDOWN.REGISTER,$,a)}),t.on(b.SUITE.HOOKS.UNREGISTER,()=>{e.emit(b.SPEC.SETUP.UNREGISTER),e.emit(b.SPEC.TEARDOWN.UNREGISTER)}),e.on(b.SPEC.STARTED,$=>{h.emit(b.DATABASE.RECORD.CREATE,$)}),e.on(b.SPEC.SUCCESS,$=>{h.emit(b.DATABASE.RECORD.UPDATE,$,B.SUCCESS)}),e.on(b.SPEC.IGNORE,$=>{h.emit(b.DATABASE.RECORD.UPDATE,$,B.IGNORED)}),e.on(b.SPEC.FAILURE,($,E)=>{h.emit(b.DATABASE.RECORD.UPDATE,$,B.FAILURE,E),U.emit(b.PROCESS.EXIT_CODE.FAILURE)}),e.on(b.SPEC.ENDED,$=>{h.emit(b.DATABASE.RECORD.CLOSE,$)}),h.on(b.DATABASE.PROCESS.ENDED,$=>{this._reporters.forEach(E=>{E.emit(b.REPORTER.REPORT.START,$)})}),h.on(b.DATABASE.RECORDSET.CLOSED,$=>{t.emit(b.SUITE.ENDED,$)}),this._reporters.forEach($=>{$.on(b.REPORTER.REPORT.ENDED,()=>{U.emit(b.PROCESS.EXIT)})})}};jb=new lb}var rb,C,D,V,ob,i,W,pb=false;function qb(){if(pb)return;pb=true;rb={};({spec:C,xspec:D}=(M(),L));({suite:V}=(P(),N));ob=(nb(),jb);ob.init();i={};W={suite:V.bind(i),describe:V.bind(i),spec:C.bind(i),it:C.bind(i),test:C.bind(i),xspec:D.bind(i),xit:D.bind(i),xtest:D.bind(i)};Object.assign(Y,W),rb=W}var X=function(){var exports=this,module={exports:this};const{resolve:resolve}=require("path"),{existsSync:existsSync}=require("fs");return function main(){const argvParser=new o(process.argv),CLIOptions=argvParser.getCLIOptions();CLIOptions[o.CLI_OPTION.HELP]?(E.printHelp(),process.exit(0)):CLIOptions[o.CLI_OPTION.VERSION]&&(E.printVersion(),process.exit(0));const rootDirectoryPath=resolve(CLIOptions[o.CLI_OPTION.DIRECTORY]);if(!rootDirectoryPath)throw new Error("Missing path to test file! Use `titef --help` for further information");if(!existsSync(rootDirectoryPath))throw new Error(`The directory at ${rootDirectoryPath} does not exist! Use \`titef --help\` for further information`);ra(),qb();const directoryWalkerOptions={extensions:CLIOptions[o.CLI_OPTION.EXTENSIONS]},directoryWalker=new Z(rootDirectoryPath,directoryWalkerOptions),testFiles=directoryWalker.getFiles();testFiles.forEach(testFile=>{eval("require")(testFile)})}(),module.exports}.call({});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=X}else if(typeof define==="function"&&define.amd){define(function(){return X})}})();