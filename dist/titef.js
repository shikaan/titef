(function () {var oa=this;var k={};const na={PROCESS:{EXIT:"process:exit",EXIT_CODE:{FAILURE:"process:exit-code:failure"}},DATABASE:{RECORDSET:{CREATE:"database:recordset:create",CLOSED:"database:recordset:closed"},RECORD:{CREATE:"database:record:create",UPDATE:"database:record:update",CLOSE:"database:record:close"},PROCESS:{ENDED:"database:process:ended"}},SUITE:{STARTED:"suite:started",HOOKS:{REGISTER:"suite:hooks:register",UNREGISTER:"suite:hooks:unregister"},ENDED:"suite:ended"},SPEC:{SETUP:{REGISTER:"spec:before-each:register",UNREGISTER:"spec:before-each:unregister"},TEARDOWN:{REGISTER:"spec:after-each:register",UNREGISTER:"spec:after-each:unregister"},STARTED:"spec:started",SUCCESS:"spec:success",IGNORE:"spec:ignore",FAILURE:"spec:failure",ENDED:"spec:ended"},REPORTER:{REPORT:{START:"reporter:report:start",ENDED:"reporter:report:ended"}}},w={PENDING:"PENDING",SUCCESS:"SUCCESS",FAILURE:"FAILURE",IGNORED:"IGNORED"},ma=Object.values(w),la=Number.parseInt(/(\d+)./.exec(process.version)[1],10);k={EVENT:na,NODE_MAJOR_VERSION:la,RESULT:w,RESULTS:ma};var B={};const ka=require("events"),{EVENT:g}=k,a=new ka,h={before:{},after:{}};async function ja($,r){const e=String($).replace("."," "),i=this.path,S=`${i}.${e}`;a.emit(g.SPEC.STARTED,S),h.before&&h.before[i]&&h.before[i]();try{await r(),a.emit(g.SPEC.SUCCESS,S)}catch(n){a.emit(g.SPEC.FAILURE,S,n)}h.after&&h.after[i]&&h.after[i](),a.emit(g.SPEC.ENDED,S)}async function ha($){const r=String($).replace("."," "),e=`${this.path}.${r}`;a.emit(g.SPEC.STARTED,e),a.emit(g.SPEC.IGNORE,e),a.emit(g.SPEC.ENDED,e)}a.on(g.SPEC.SETUP.REGISTER,($,r)=>{h.before[$]=r}),a.on(g.SPEC.TEARDOWN.REGISTER,($,r)=>{h.after[$]=r}),a.on(g.SPEC.SETUP.UNREGISTER,$=>{h.before[$]=null}),a.on(g.SPEC.TEARDOWN.UNREGISTER,$=>{h.after[$]=null}),B={spec:ja,xspec:ha,Spec:a};var y={};const ga=t=>"[object Number]"===Object.prototype.toString.call(t),fa=t=>/\[object (Async)?Function]/.test(Object.prototype.toString.call(t)),ea=t=>"[object Object]"===Object.prototype.toString.call(t);y={isNumber:ga,isFunction:fa,isObject:ea};var E={};function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ba(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach(function(t){_(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const $=require("events"),{isFunction:q,isObject:I}=y,{EVENT:p}=k,l=new $;function X(e,t){const r=e[0],n=e[1];switch(e.length){case 1:if(!q(r))throw new TypeError("Second argument must be a function!");return{options:t,callback:r};case 2:if(!I(r))throw new TypeError("Second argument must be an object!");if(!q(n))throw new TypeError("Third argument must be a function!");return{options:ba({},t,{},r),callback:n};default:throw new TypeError(`Invalid arguments! Expected (title: string, options?: object, callback: function). Actual: ${e.map(String).join()}`);}}function V(e,...t){const r=String(e).replace("."," "),n=this.path,$=n?`${n}.${r}`:r,a={title:r,setup:Function(),teardown:Function(),eachSetup:Function(),eachTeardown:Function(),silent:!1},{options:i,callback:o}=X(t,a);if(l.emit(p.SUITE.STARTED,$,i.silent),l.emit(p.SUITE.HOOKS.REGISTER,$,i.eachSetup,i.eachTeardown),!q(i.setup))throw new TypeError("Setup must be a function!");i.setup(),o.call(Object.assign(this,{path:$})),Object.assign(this,{path:n}),l.on(p.SUITE.ENDED,e=>{if(e===$){if(!q(i.teardown))throw new TypeError("Teardown must be a function!");i.teardown(),l.emit(p.SUITE.HOOKS.UNREGISTER),l.removeAllListeners(p.SUITE.ENDED)}})}E={suite:V,Suite:l};var T={};const O={RED:"\x1B[31m",GREEN:"\x1B[32m",YELLOW:"\x1B[33m",RESET:"\x1B[0m",BOLD:"\x1B[1m",GREY:"\x1B[90m"};T={TEXT_FORMAT:O};var K={};const{isFunction:Z}=y,{TEXT_FORMAT:c}=T,{NODE_MAJOR_VERSION:J,RESULT:u}=k,d=(...$)=>{const r=[...$,c.RESET,"\n"];return process.stdout.write(r.map(String).join(""))},s=$=>Z($)?$.name:String($),L=$=>$.message?$.message:$.toString().split(":").slice(-1)[0],M=$=>"ERR_ASSERTION"===$.code||$.toString().includes("AssertionError"),N=$=>{const r=L($),t=J<10;if(M($)){const a=s($.operator),e=s($.expected),p=s($.actual);t&&d(`ASSERTION FAILURE: ${r}`),"fail"===a?d("\tUnexpected:\t",c.RED,`${p}`):!a&&$.expected&&$.actual&&(d("\tExpected:\t",c.GREEN,e),d("\tActual:\t\t",c.RED,p))}else t&&d(`ERROR: ${r}`);d(c.GREY,$.stack)},D=($,r,t="")=>{const a={};if(!$.meta.silent){const a=$.meta.duration>2e3?[c.RESET,c.YELLOW,` (${Math.ceil($.meta.duration)}ms)`]:[];d(c.BOLD,`${t}${r.toUpperCase()}`,...a)}return Object.entries($).forEach(([e,p])=>{if(!(p.meta&&p.meta.silent||$.meta.silent)){if(p.meta)Object.assign(a,D(p,e,`${t}    `));else{const $=p.duration>500?[c.YELLOW,` (${Math.ceil(p.duration)}ms)`]:[];p.result===u.SUCCESS?d(c.GREEN,`${t} ✔ ${e}`,...$):p.result===u.IGNORED?d(c.YELLOW,`${t} - ${e}`,...$):p.result===u.PENDING?d(c.GREY,`${t} . ${e}`,...$):(d(c.RED,`${t} ✕ ${e}`),a[`${r} > ${e}`]=p.payload)}}}),a},P=async $=>{let r={};Object.entries($).forEach(([$,t])=>{r=D(t,$),d("\n  Duration: ",c.YELLOW,`${Math.ceil(t.meta.duration)/1e3}s`)});const t=Object.entries(r);t.length&&(d(c.BOLD,"\nError details:"),t.forEach(($,r)=>{const t=$[0],a=$[1];d(c.BOLD,`\n${r+1}) ${t}`),N(a)}))};K={printDatabase:P};var Q={};const R=require("events"),{printDatabase:S}=K,{EVENT:C}=k;class U extends R{constructor(){super(),this.on(C.REPORTER.REPORT.START,async $=>{await S($),this.emit(C.REPORTER.REPORT.ENDED)})}}Q=new U;var i={};const W=require("events"),{EVENT:m,RESULT:Y,RESULTS:x}=k;class f extends W{static create(t,e,r){const[s,a]=e.split(/\.(.*)/);return a?(t[s]=t[s]||{},f.create(t[s],a,r)):(t[s]=r,t)}static open(t,e){const[r,s]=e.split(/\.(.*)/);return s?f.open(t[r],s):t[r]}static parent(t,e){const[r,s]=e.split(/\.(.*)/);return s?f.parent(t[r],s):t}static toMilliseconds([t,e]){return(1e9*t+e)/1e6}constructor(){super(),this._recordsets={},this._processed=0,this._created=0,this.on(m.DATABASE.RECORDSET.CREATE,this.createRecordset),this.on(m.DATABASE.RECORD.CREATE,this.createRecord),this.on(m.DATABASE.RECORD.UPDATE,this.updateRecord),this.on(m.DATABASE.RECORD.CLOSE,this.closeRecord)}createRecordset(t,e){const r={duration:process.hrtime(),processed:0,path:t,silent:e};f.create(this._recordsets,t,Object.defineProperty({},"meta",{value:r}))}createRecord(t){if(!t)throw new TypeError("Missing record path!");if(!f.parent(this._recordsets,t))throw new TypeError(`Missing or null records list for ${t}`);this._created+=1,f.create(this._recordsets,t,{result:Y.PENDING,payload:null,duration:process.hrtime()})}updateRecord(t,e,r){if(!x.includes(e))throw new TypeError(`Result should be one of ${x.join()}. Got ${e}.`);const s=f.open(this._recordsets,t);if(!s)throw new TypeError(`Missing or null records list for ${t}`);s.result=e,s.payload=r}closeRecord(t){setImmediate(()=>{this._processed+=1;const e=this._processed===this._created,r=f.parent(this._recordsets,t);r.meta.processed+=1;const s=Object.values(r).filter(t=>!t.meta).length,a=r.meta.processed===s;if(e)r.meta.duration=f.toMilliseconds(process.hrtime(r.meta.duration)),this.emit(m.DATABASE.PROCESS.ENDED,this._recordsets);else if(a)r.meta.duration=f.toMilliseconds(process.hrtime(r.meta.duration)),this.emit(m.DATABASE.RECORDSET.CLOSED,r.meta.path);else{const e=f.open(this._recordsets,t);e.duration=f.toMilliseconds(process.hrtime(e.duration))}})}}i=new f;var H={};const aa=require("events"),{EVENT:G}=k;class ca extends aa{constructor(){super(),this._exitCode=0,this.on(G.PROCESS.EXIT,()=>{setImmediate(()=>{process.exit(this._exitCode)})}),this.on(G.PROCESS.EXIT_CODE.FAILURE,()=>{this._exitCode=1})}}H=new ca;var da={};const{EVENT:b,RESULT:o}=k,{Spec:e}=B,{Suite:n}=E;class ia{init(){this._reporters=[Q],n.on(b.SUITE.STARTED,($,E)=>{i.emit(b.DATABASE.RECORDSET.CREATE,$,E)}),n.on(b.SUITE.HOOKS.REGISTER,($,E,a)=>{e.emit(b.SPEC.SETUP.REGISTER,$,E),e.emit(b.SPEC.TEARDOWN.REGISTER,$,a)}),n.on(b.SUITE.HOOKS.UNREGISTER,()=>{e.emit(b.SPEC.SETUP.UNREGISTER),e.emit(b.SPEC.TEARDOWN.UNREGISTER)}),e.on(b.SPEC.STARTED,$=>{i.emit(b.DATABASE.RECORD.CREATE,$)}),e.on(b.SPEC.SUCCESS,$=>{i.emit(b.DATABASE.RECORD.UPDATE,$,o.SUCCESS)}),e.on(b.SPEC.IGNORE,$=>{i.emit(b.DATABASE.RECORD.UPDATE,$,o.IGNORED)}),e.on(b.SPEC.FAILURE,($,E)=>{i.emit(b.DATABASE.RECORD.UPDATE,$,o.FAILURE,E),H.emit(b.PROCESS.EXIT_CODE.FAILURE)}),e.on(b.SPEC.ENDED,$=>{i.emit(b.DATABASE.RECORD.CLOSE,$)}),i.on(b.DATABASE.PROCESS.ENDED,$=>{this._reporters.forEach(E=>{E.emit(b.REPORTER.REPORT.START,$)})}),i.on(b.DATABASE.RECORDSET.CLOSED,$=>{n.emit(b.SUITE.ENDED,$)}),this._reporters.forEach($=>{$.on(b.REPORTER.REPORT.ENDED,()=>{H.emit(b.PROCESS.EXIT)})})}}da=new ia;var v={};const{spec:r,xspec:t}=B,{suite:z}=E;da.init();const j={},A={suite:z.bind(j),describe:z.bind(j),spec:r.bind(j),it:r.bind(j),test:r.bind(j),xspec:t.bind(j),xit:t.bind(j),xtest:t.bind(j)};Object.assign(oa,A),v=A;if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=v}else if(typeof define==="function"&&define.amd){define(function(){return v})}})();